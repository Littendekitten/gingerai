<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GingerAI Chat</title>
<style>
html, body {
    height: 100%;
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(120deg, #ff7e5f, #feb47b);
    overflow: hidden;
}

/* Sidebar */
#sidebar {
    width: 240px;
    background: #ff9a5c;
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    z-index: 1000;
    padding-top: 10px;
}
#sidebar.open {
    transform: translateX(0);
}
#sidebar-logo {
    width: 60%;
    margin: 10px auto;
    display: block;
}
#new-chat-btn {
    background: #ff6600;
    color: #fff;
    border-radius:5px;
    padding: 6px 8px;
    margin: 10px auto;
    cursor:pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size:0.85em;
}
#new-chat-btn:hover { background:#e65c00; }

#chat-list {
    flex: 1;
    overflow-y: auto;
    padding: 5px 10px;
    font-size:0.85em;
}
.chat-item {
    display: flex;
    justify-content: space-between;
    padding: 5px 6px;
    margin-bottom: 4px;
    background: #ffb487;
    border-radius: 5px;
    cursor: pointer;
}
.chat-item span:first-child { overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.chat-item:hover { background: #ffa75f; }

/* Hamburger */
#hamburger {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 1100;
    background: #ff6600;
    color: #fff;
    padding: 8px 12px;
    border-radius:5px;
    cursor: pointer;
}
#hamburger:hover { background: #e65c00; }

/* Chat content */
#chat-container {
    position: absolute;
    top:0;
    bottom:0;
    right:0;
    left:0;
    display: flex;
    flex-direction: column;
    background: #fff;
    margin-left: 0;
    transition: margin-left 0.3s ease;
    max-width: 900px;
    margin: 0 auto;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
}

/* Messages */
#messages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    font-size: 1em;
    background: #fff;
}
.message { margin:5px 0; }
.user { color: #0066cc; }
.ginger { color: #cc6600; }

/* Input */
#input-container {
    display: flex;
    flex-shrink: 0;
    padding: 8px;
    border-top:1px solid #ddd;
    background: #fafafa;
}
#message-input {
    flex:1;
    padding:8px;
    border-radius:5px;
    border:1px solid #ccc;
    font-size:1em;
}
#send-btn {
    padding:8px 12px;
    background:#ff6600;
    color:#fff;
    border-radius:5px;
    margin-left:5px;
}
#send-btn:hover { background:#e65c00; }

/* Desktop styles */
@media(min-width:701px){
    #sidebar { transform: translateX(0); position: relative; }
    #hamburger { display: none; }
    #chat-container { margin-left: 240px; height: calc(100% - 40px); top: 20px; bottom: 20px; }
}

/* Mobile styles */
@media(max-width:700px){
    #chat-container {
        width: 100%;
        border-radius: 0;
    }
    #messages { font-size:0.85em; padding:6px; }
    #input-container { padding:4px; }
}
</style>
</head>
<body>

<div id="sidebar">
    <img src="assets/logo.png" id="sidebar-logo" alt="Logo">
    <button id="new-chat-btn">New Chat <span style="margin-left:5px; font-size:1.1em;">&#x1F5D1;</span></button>
    <div id="chat-list"></div>
</div>

<div id="hamburger">&#9776;</div>

<div id="chat-container">
    <div id="messages"></div>
    <div id="input-container">
        <input type="text" id="message-input" placeholder="Type your message...">
        <button id="send-btn">Send</button>
    </div>
</div>

<script src="train_gingerai.js"></script>
<script>
let chats = [];
let currentChat = null;

const sidebar = document.getElementById('sidebar');
const messagesEl = document.getElementById('messages');
const chatListEl = document.getElementById('chat-list');
const input = document.getElementById('message-input');
const sendBtn = document.getElementById('send-btn');
const newChatBtn = document.getElementById('new-chat-btn');
const hamburger = document.getElementById('hamburger');

function addMessage(text, sender){
    const div = document.createElement('div');
    div.classList.add('message', sender);
    div.textContent = text;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
}

function renderChatList(){
    chatListEl.innerHTML = '';
    chats.forEach((chat, idx)=>{
        const div = document.createElement('div');
        div.classList.add('chat-item');
        div.innerHTML = `<span>${chat.name}</span> <span style="cursor:pointer;color:red;" onclick="deleteChat(${idx})">&#x1F5D1;</span>`;
        div.addEventListener('click',()=>loadChat(idx));
        chatListEl.appendChild(div);
    });
}

function createChat(){
    const name = `Chat ${chats.length+1}`;
    const chat = {name, messages:[]};
    chats.push(chat);
    currentChat = chats.length-1;
    renderChatList();
    renderMessages();
}

function loadChat(idx){
    currentChat = idx;
    renderMessages();
    sidebar.classList.remove('open');
}

function deleteChat(idx){
    if(currentChat===idx) currentChat=null;
    chats.splice(idx,1);
    renderChatList();
    renderMessages();
}

function renderMessages(){
    messagesEl.innerHTML = '';
    if(currentChat===null) return;
    chats[currentChat].messages.forEach(m=>addMessage(m.text,m.sender));
}

async function sendMessage(){
    const text = input.value.trim();
    if(!text) return;
    input.value='';
    if(currentChat===null) createChat();
    chats[currentChat].messages.push({text,sender:'user'});
    addMessage(text,'user');

    try{
        const response = await window.GingerAI.ask(text);
        chats[currentChat].messages.push({text:response, sender:'ginger'});
        addMessage(response,'ginger');
    }catch(e){
        const err = "Error: GingerAI unavailable.";
        chats[currentChat].messages.push({text:err,sender:'ginger'});
        addMessage(err,'ginger');
    }
    renderChatList();
}

sendBtn.addEventListener('click',sendMessage);
input.addEventListener('keydown',e=>{if(e.key==='Enter') sendMessage();});
newChatBtn.addEventListener('click',createChat);
hamburger.addEventListener('click',()=>sidebar.classList.toggle('open'));
</script>

</body>
</html>
